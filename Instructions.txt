#Building and pushing image to repo
#------------------------------------
cd /usr
sudo su -l ubuntu
aws configure sso --use-device-code

#Responses to the aws configure (similar to Practical: Publishing an image to AWS ECR):
default
ap-southeast-2
#skip
default

aws ecr get-login-password --region ap-southeast-2 | docker login --username AWS --password-stdin 901444280953.dkr.ecr.ap-southeast-2.amazonaws.com

#clone main branch of git repo
git clone https://github.com/FindabhairDoolan/CAB432-Group101.git
#Or if specific branch do: 
git clone --branch <branch name> https://github.com/FindabhairDoolan/CAB432-Group101.git

cd CAB432-Group101
nano .env
#Paste .env in here from extras

#this will build just the main app that needs to be pushed in ecr, app will not work until later pulled from ecr
docker build -t cab432-group101 .

docker images
#with docker images find app image id and replace below
docker tag <image id> 901444280953.dkr.ecr.ap-southeast-2.amazonaws.com/group101-assessment2-repo
docker push 901444280953.dkr.ecr.ap-southeast-2.amazonaws.com/group101-assessment2-repo


#Pulling image from ecr
#-----------------------------------
cd /usr
sudo su -l ubuntu
aws configure sso --use-device-code

#Responses to the aws configure (similar to Practical: Publishing an image to AWS ECR):
default
ap-southeast-2
#skip
default

aws ecr get-login-password --region ap-southeast-2 | docker login --username AWS --password-stdin 901444280953.dkr.ecr.ap-southeast-2.amazonaws.com

mkdir videorestapi
cd videorestapi
nano .env
#Copy .env contents in from Extra branch in GitHub
nano docker-compose.yml
#Copy docker compose in from Extra branch


docker compose pull
docker compose up

#presigned url command
#--------------------------------
#Note that this is for git bash, and path url must be translated from this "C:\Users\fdool\Videos\video.mkv"
#to this C:/Users/fdool/Videos/video.mkv
curl -X PUT -T "C:/Users/fdool/Videos/video.mkv" "URL"
